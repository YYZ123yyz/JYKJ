package yyz_exploit.activity;

import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.ImageView;

import com.tencent.rtmp.TXLiveBase;
import com.tencent.rtmp.TXLivePushConfig;
import com.tencent.rtmp.TXLivePusher;
import com.tencent.rtmp.ui.TXCloudVideoView;

import www.jykj.com.jykj_zxyl.R;

public class LivePushActivity extends AppCompatActivity {

    private TXCloudVideoView mPusherView;
    private ImageView live_back;
    private TXLivePusher mLivePusher;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_live_push);
        //直播
        TXLivePushConfig mLivePushConfig  = new TXLivePushConfig();
        mLivePusher = new TXLivePusher(this);
        // 一般情况下不需要修改 config 的默认配置
        mLivePusher.setConfig(mLivePushConfig);

        //启动本地摄像头预览
        mPusherView = (TXCloudVideoView) findViewById(R.id.pusher_tx_cloud_view);
        mLivePusher.startCameraPreview(mPusherView);
        //此处填写您的 rtmp 推流地址
        String rtmpURL = "rtmp://push.jiuyihtn.com/live/jykj?txSecret=725909d9562056661d64105c70dce36f&txTime=5EA5AFFF";

        int ret = mLivePusher.startPusher(rtmpURL.trim());
        if (ret == -5) {
            Log.i("TAG", "startRTMPPush: license 校验失败");
        }

       ininView();
    }

    private void ininView() {
        live_back = findViewById(R.id.live_back);
        live_back.bringToFront();
        live_back.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                mLivePusher.stopPusher();
              mLivePusher.stopCameraPreview(true); //如果已经启动了摄像头预览，请在结束推流时将其关闭。
                finish();
            }
        });
    }
}
